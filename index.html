<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="robots" content="noindex">
  <title>US Adult Content Compliance Dashboard</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Auth Check -->
  <script>
    // Check authentication before loading page
    const authToken = localStorage.getItem('auth_token');
    const authExpiry = localStorage.getItem('auth_expiry');
    
    if (!authToken || !authExpiry || new Date().getTime() >= parseInt(authExpiry)) {
      // Not authenticated or expired, redirect to login
      window.location.href = 'login.html';
    }
  </script>
  
  <style>
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
    }
    
    #map-container {
      position: fixed;
      top: 50px;
      left: 0;
      right: 0;
      bottom: 0;
      z-index: 1;
    }
    
    #map { 
      height: 100%;
      width: 100%;
    }
    
    .state-detail-panel {
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    .state-detail-panel.open {
      transform: translateX(0);
    }
    
    .tier-badge {
      display: inline-block;
      padding: 0.25rem 0.75rem;
      border-radius: 0.375rem;
      font-weight: 600;
      font-size: 0.875rem;
    }
    .tier-0 { background-color: #10b981; color: white; }
    .tier-1 { background-color: #3b82f6; color: white; }
    .tier-2 { background-color: #eab308; color: #1f2937; }
    .tier-3 { background-color: #f97316; color: white; }
    .tier-4 { background-color: #ef4444; color: white; }
    
    .floating-card {
      position: fixed;
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      z-index: 10;
    }
    
    .tab-content-overlay {
      position: fixed;
      top: 50px;
      left: 0;
      right: 0;
      bottom: 0;
      background: white;
      overflow-y: auto;
      z-index: 5;
    }
    
    details summary { cursor: pointer; }
    details summary:hover { background-color: #f3f4f6; }
  </style>
</head>
<body>
  
  <!-- Sticky Header -->
  <header class="fixed top-0 left-0 right-0 bg-white border-b border-gray-200 z-50">
    <div class="px-4 py-2 flex items-center justify-between">
      <h1 class="text-lg font-bold text-gray-900">US Age Verification Compliance</h1>
      <nav class="flex gap-1">
        <button class="tab-btn active px-4 py-2 text-sm font-medium text-blue-600 border-b-2 border-blue-600" data-tab="map">
          Map
        </button>
        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent" data-tab="table">
          Data
        </button>
        <button class="tab-btn px-4 py-2 text-sm font-medium text-gray-600 hover:text-gray-900 border-b-2 border-transparent" data-tab="resources">
          Glossary
        </button>
      </nav>
    </div>
  </header>

  <!-- Full Screen Map Container -->
  <div id="map-container">
        <div id="map"></div>
      </div>

  <!-- Floating Tier Selector Card (Map View Only) -->
  <div id="tier-selector-card" class="floating-card" style="top: 70px; left: 20px; width: 280px; max-height: calc(100vh - 100px); overflow-y: auto;">
    <div class="p-4">
      <h3 class="font-semibold text-sm mb-3">Select Tiers to Display</h3>
      <div class="space-y-2 text-sm">
        <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
          <input type="checkbox" class="tier-filter-checkbox mr-2" value="0" checked>
          <div class="w-3 h-3 rounded tier-0 mr-2"></div>
          <span>Tier 0 - No Requirements</span>
            </label>
        <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
          <input type="checkbox" class="tier-filter-checkbox mr-2" value="1" checked>
          <div class="w-3 h-3 rounded tier-1 mr-2"></div>
          <span>Tier 1 - Credit Card OK</span>
            </label>
        <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
          <input type="checkbox" class="tier-filter-checkbox mr-2" value="2" checked>
          <div class="w-3 h-3 rounded tier-2 mr-2"></div>
          <span>Tier 2 - Transactional Data</span>
            </label>
        <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
          <input type="checkbox" class="tier-filter-checkbox mr-2" value="3" checked>
          <div class="w-3 h-3 rounded tier-3 mr-2"></div>
          <span>Tier 3 - Strict</span>
            </label>
        <label class="flex items-center cursor-pointer hover:bg-gray-50 p-1 rounded">
          <input type="checkbox" class="tier-filter-checkbox mr-2" value="4" checked>
          <div class="w-3 h-3 rounded tier-4 mr-2"></div>
          <span>Tier 4 - Avoid</span>
            </label>
          </div>
              </div>
              </div>

  <!-- Floating Stats Card (Map View Only) -->
  <div id="stats-card" class="floating-card" style="bottom: 20px; left: 20px; width: 320px;">
    <div class="p-4">
      <h3 class="font-semibold text-sm mb-3">Market Coverage</h3>
      <div class="grid grid-cols-2 gap-3 text-sm">
              <div>
          <div class="text-xs text-gray-500">States</div>
          <div class="text-2xl font-bold text-blue-600" id="selected-states-count">51</div>
              </div>
              <div>
          <div class="text-xs text-gray-500">US Population</div>
          <div class="text-2xl font-bold text-blue-600" id="selected-population-percent">100%</div>
              </div>
        <div class="col-span-2">
          <div class="text-xs text-gray-500">Total Population</div>
          <div class="text-lg font-semibold" id="selected-population-count">344M</div>
            </div>
        <div class="col-span-2 pt-2 border-t">
          <div class="text-xs text-gray-500 mb-1">Verification Methods Needed</div>
          <div class="text-xs space-y-1" id="verification-methods">
            <div>‚Ä¢ Credit card verification</div>
            <div>‚Ä¢ Transactional data services</div>
            <div>‚Ä¢ IAL2 identity verification</div>
          </div>
            </div>
          </div>
        </div>
      </div>

  <!-- Data Table Tab Content (Hidden by default) -->
  <div id="tab-table" class="tab-content-overlay hidden">
    <div class="max-w-7xl mx-auto px-4 py-6">
        <div class="mb-4 flex justify-between items-center">
          <h2 class="text-lg font-semibold">All States Data</h2>
          <input type="text" id="search" placeholder="Search states..." class="border rounded px-3 py-2 text-sm">
        </div>
        
      <div class="overflow-x-auto bg-white rounded-lg shadow">
          <table class="min-w-full divide-y divide-gray-200" id="states-table">
            <thead class="bg-gray-50">
              <tr>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" data-sort="state">
                  State ‚Üï
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" data-sort="tier">
                  Tier ‚Üï
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer" data-sort="population">
                  Pop % ‚Üï
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  LGBTQ+
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  ID Req?
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Max Penalty
                </th>
                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Actions
                </th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200" id="table-body">
              <!-- Populated by JavaScript -->
            </tbody>
          </table>
      </div>
        </div>
      </div>

  <!-- Glossary Tab Content (Hidden by default) -->
  <div id="tab-resources" class="tab-content-overlay hidden">
    <div class="max-w-4xl mx-auto px-4 py-6">
      <h2 class="text-lg font-semibold mb-4">Legal Terms Glossary</h2>
      <p class="text-xs text-gray-500 mb-4">Click each term to expand from simple to detailed explanation</p>
      
      <div class="space-y-3">
          
          <details class="border rounded p-3">
            <summary class="font-medium cursor-pointer">Material Harmful to Minors</summary>
            <div class="text-sm text-gray-700 mt-2 space-y-3">
              <div>
                <strong class="text-blue-600">üîµ Simple:</strong><br>
                Sexual content that's inappropriate for people under 18.
              </div>
              <div>
                <strong class="text-green-600">üü¢ Intermediate:</strong><br>
                Content depicting sexual acts that's offensive by community standards and has no serious value for minors. Based on the "Miller test" but modified for minors.
              </div>
              <div>
                <strong class="text-orange-600">üü† Detailed:</strong><br>
                A three-part legal test (modified Miller test) where ALL three must be true:<br>
                1. The average person, using contemporary community standards, would find it appeals to minors' prurient (shameful/morbid) interest in sex<br>
                2. It depicts sexual conduct in a patently offensive way for minors<br>
                3. It lacks serious literary, artistic, political, or scientific value <em>for minors</em><br><br>
                <strong>Key difference from adult obscenity:</strong> Each prong adds "for minors" - so material can be legal for adults but "harmful to minors."
              </div>
            </div>
          </details>

          <details class="border rounded p-3">
            <summary class="font-medium cursor-pointer">IAL2 (Identity Assurance Level 2)</summary>
            <div class="text-sm text-gray-700 mt-2 space-y-3">
              <div>
                <strong class="text-blue-600">üîµ Simple:</strong><br>
                Strong ID verification using government documents plus a selfie. Required by Arkansas and Georgia.
              </div>
              <div>
                <strong class="text-green-600">üü¢ Intermediate:</strong><br>
                A federal government standard (NIST) for proving someone's identity online with "high confidence." Requires multiple types of proof including photo ID and biometric verification (like face matching).
              </div>
              <div>
                <strong class="text-orange-600">üü† Detailed:</strong><br>
                <strong>Official Standard:</strong> NIST Special Publication 800-63A<br>
                <strong>Evidence Required:</strong> One STRONG + one FAIR piece of evidence, OR one SUPERIOR piece<br>
                <strong>Typical Process:</strong><br>
                ‚Ä¢ Personal information (name, DOB, address)<br>
                ‚Ä¢ Government-issued photo ID (driver's license, passport)<br>
                ‚Ä¢ Biometric verification (live selfie matched to ID photo)<br>
                ‚Ä¢ Background database checks<br><br>
                <strong>Why it's strict:</strong> Designed to prevent impersonation attacks and identity fraud at government-level security. More rigorous than typical e-commerce verification.<br><br>
                <strong>Cost implication:</strong> Requires specialized third-party services ($1-5 per verification). Cannot be done with simple credit card checks.
              </div>
            </div>
          </details>

          <details class="border rounded p-3">
            <summary class="font-medium cursor-pointer">Transactional Data</summary>
            <div class="text-sm text-gray-700 mt-2 space-y-3">
              <div>
                <strong class="text-blue-600">üîµ Simple:</strong><br>
                Records from business transactions and databases that can prove someone's age. Examples: mortgage records, employment history, education records.
              </div>
              <div>
                <strong class="text-green-600">üü¢ Intermediate:</strong><br>
                "A sequence of information that documents an exchange, agreement, or transfer between an individual, commercial entity, or third party." Used by third-party age verification companies that access commercial databases containing adult records.
              </div>
              <div>
                <strong class="text-orange-600">üü† Detailed:</strong><br>
                <strong>Legal Definition (from statutes):</strong> "Public or private transactional data" means records documenting exchanges, agreements, or transfers that can verify age.<br><br>
                <strong>Specific Examples from State Laws:</strong><br>
                ‚Ä¢ Mortgage/property records (must be 18+ to sign)<br>
                ‚Ä¢ Employment records (W-2s, payroll data)<br>
                ‚Ä¢ Educational records (college enrollment)<br>
                ‚Ä¢ Utility bills, insurance policies<br>
                ‚Ä¢ Commercial database entries<br><br>
                <strong>How it works:</strong> Third-party services (like Yoti, Veriff, ID.me) check if your name/DOB appears in these adult-only databases.<br><br>
                <strong>The Credit Card Question:</strong> Most statutes say "public or private transactional data" but DON'T explicitly say if credit cards count. Only South Dakota, Wyoming, and Nebraska explicitly allow credit cards. Other states remain unclear.<br><br>
                <strong>Implementation:</strong> Typically costs $0.05-0.25 per verification through specialized vendors.
              </div>
            </div>
          </details>

          <details class="border rounded p-3">
            <summary class="font-medium cursor-pointer">Commercially Reasonable Method</summary>
            <div class="text-sm text-gray-700 mt-2 space-y-3">
              <div>
                <strong class="text-blue-600">üîµ Simple:</strong><br>
                Age verification methods that work in the real world and are used by legitimate businesses.
              </div>
              <div>
                <strong class="text-green-600">üü¢ Intermediate:</strong><br>
                Methods "regularly used by government or businesses for age and identity verification" (Florida's definition). Must be practical to implement while effectively confirming users are 18+.
              </div>
              <div>
                <strong class="text-orange-600">üü† Detailed:</strong><br>
                <strong>The Problem:</strong> No state defines this precisely. It's intentionally vague legal language.<br><br>
                <strong>Generally Accepted Methods:</strong><br>
                ‚Ä¢ Government-issued ID verification (most common)<br>
                ‚Ä¢ Digital ID apps (state-approved)<br>
                ‚Ä¢ Third-party verification services<br>
                ‚Ä¢ Database lookups (transactional data)<br>
                ‚Ä¢ Biometric verification<br><br>
                <strong>What's NOT Clear:</strong><br>
                ‚Ä¢ Are credit cards "commercially reasonable"? (Disputed - only 3 states explicitly allow)<br>
                ‚Ä¢ How much verification is "reasonable"? (Court precedent lacking)<br>
                ‚Ä¢ What accuracy rate is required? (Not specified)<br><br>
                <strong>Legal Standard Applied:</strong> Would a "reasonable business person" consider this method adequate for age verification? Courts will decide case-by-case.<br><br>
                <strong>Risk:</strong> This vagueness means you could implement something you think is "reasonable" and still face litigation. Conservative interpretation recommended.
              </div>
            </div>
          </details>

          <details class="border rounded p-3">
            <summary class="font-medium cursor-pointer">Digital ID / Digitized ID</summary>
            <div class="text-sm text-gray-700 mt-2 space-y-3">
              <div>
                <strong class="text-blue-600">üîµ Simple:</strong><br>
                A digital version of your driver's license or ID card, often in a mobile app.
              </div>
              <div>
                <strong class="text-green-600">üü¢ Intermediate:</strong><br>
                A verified digital credential (like Apple Wallet ID or state-specific apps) that proves your identity and age without sharing your actual ID document.
              </div>
              <div>
                <strong class="text-orange-600">üü† Detailed:</strong><br>
                <strong>Types:</strong><br>
                ‚Ä¢ <em>State-issued mobile IDs</em>: Official digital versions of driver's licenses (e.g., Arizona, Colorado, Maryland apps)<br>
                ‚Ä¢ <em>Third-party digital IDs</em>: Verified credentials from services like Clear, ID.me<br>
                ‚Ä¢ <em>Scanned/photo IDs</em>: Pictures of physical IDs (least secure, often not accepted)<br><br>
                <strong>Arizona's specific requirement:</strong> Digital ID that "does not cause information to be transmitted to a governmental entity" - meaning privacy-preserving verification.<br><br>
                <strong>How they work:</strong> Use cryptographic signatures to prove authenticity without exposing your full ID. Some use zero-knowledge proofs (only share "over 18" boolean, not your exact age).<br><br>
                <strong>Adoption:</strong> Still emerging technology. Not all states have digital ID programs yet.
              </div>
            </div>
          </details>

          <details class="border rounded p-3">
            <summary class="font-medium cursor-pointer">Private Right of Action</summary>
            <div class="text-sm text-gray-700 mt-2 space-y-3">
              <div>
                <strong class="text-blue-600">üîµ Simple:</strong><br>
                Individuals (like parents) can sue you directly, not just the government.
              </div>
              <div>
                <strong class="text-green-600">üü¢ Intermediate:</strong><br>
                When a law includes a "private right of action," any affected person can file a lawsuit against you for damages. You're not just at risk from government enforcement - anyone can sue.
              </div>
              <div>
                <strong class="text-orange-600">üü† Detailed:</strong><br>
                <strong>Why it matters:</strong> Much higher legal risk. Government has limited resources and prosecutes selectively. Private citizens can sue anytime.<br><br>
                <strong>Examples from State Laws:</strong><br>
                ‚Ä¢ <strong>Kansas:</strong> $50,000+ in statutory damages PLUS actual damages + attorney fees<br>
                ‚Ä¢ <strong>Wyoming:</strong> Parents of minors can bring civil action<br>
                ‚Ä¢ <strong>Arkansas, Kentucky, Louisiana:</strong> Individuals can sue for damages<br><br>
                <strong>Financial Risk:</strong> <br>
                ‚Ä¢ Class action lawsuit potential (thousands of plaintiffs)<br>
                ‚Ä¢ Must pay plaintiff's attorney fees if you lose<br>
                ‚Ä¢ Statutory damages (fixed amounts, don't need to prove actual harm)<br>
                ‚Ä¢ Discovery costs (defending lawsuits is expensive even if you win)<br><br>
                <strong>Comparison:</strong> States with ONLY government enforcement (Attorney General) = lower risk. States with private right of action = significantly higher litigation risk.
              </div>
            </div>
          </details>
        </div>

        <!-- Legal Disclaimer -->
      <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 my-6">
          <h3 class="font-semibold text-yellow-800 mb-2">‚ö†Ô∏è Legal Disclaimer</h3>
          <p class="text-sm text-gray-700">
          This tool is for informational purposes only and does NOT constitute legal advice. Laws are subject to change, interpretation varies, and enforcement is unpredictable. You MUST consult with a qualified attorney before making any business decisions based on this information.
          </p>
        </div>

        <!-- Data Sources -->
        <div class="bg-gray-50 rounded-lg p-4">
          <h3 class="font-medium mb-2">Data Sources</h3>
          <ul class="text-sm text-gray-700 space-y-1">
          <li>‚Ä¢ Legal requirements: Original legal research (2024-2025)</li>
          <li>‚Ä¢ Population data: US Census Bureau 2025</li>
            <li>‚Ä¢ LGBTQ+ demographics: Williams Institute, Gallup, MAP</li>
            <li>‚Ä¢ Last updated: November 2025</li>
          </ul>
        </div>
      </div>
    </div>

  <!-- State Detail Panel (Slide-out) -->
  <div id="state-panel" class="state-detail-panel fixed top-0 right-0 w-full md:w-2/3 lg:w-1/2 h-full bg-white shadow-2xl overflow-y-auto z-50">
    <div class="p-6">
      <div class="flex justify-between items-start mb-4">
        <div>
          <h2 class="text-2xl font-bold" id="panel-state-name">State Name</h2>
          <div class="flex items-center gap-2 mt-2">
            <span class="tier-badge" id="panel-tier-badge">Tier 0</span>
            <span class="text-sm text-gray-600" id="panel-lgbtq">LGBTQ+ Density: -</span>
          </div>
        </div>
        <button id="close-panel" class="text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>

      <div class="space-y-4">
        <!-- Population -->
        <div class="bg-gray-50 p-4 rounded">
          <div class="text-sm text-gray-600">Population</div>
          <div class="text-xl font-bold" id="panel-population">-</div>
          <div class="text-sm text-gray-600" id="panel-pop-percent">-% of US</div>
        </div>

        <!-- ID Required -->
        <div>
          <h3 class="font-semibold mb-2">ID Verification Required?</h3>
          <div class="text-lg" id="panel-id-required">-</div>
        </div>

        <!-- Exact Legal Language -->
        <div class="border-t pt-4">
          <h3 class="font-semibold mb-3 text-lg">üìú Exact Legal Language</h3>
          
          <details class="border rounded p-3 mb-3" open>
            <summary class="font-medium text-blue-600 cursor-pointer">Applicability</summary>
            <pre class="text-sm text-gray-700 mt-2 whitespace-pre-wrap font-sans" id="panel-applicability">-</pre>
          </details>

          <details class="border rounded p-3 mb-3">
            <summary class="font-medium text-blue-600 cursor-pointer">ID Requirements</summary>
            <pre class="text-sm text-gray-700 mt-2 whitespace-pre-wrap font-sans" id="panel-id-requirements">-</pre>
          </details>

          <details class="border rounded p-3 mb-3">
            <summary class="font-medium text-blue-600 cursor-pointer">Penalties</summary>
            <pre class="text-sm text-gray-700 mt-2 whitespace-pre-wrap font-sans" id="panel-penalties">-</pre>
          </details>

          <div class="text-sm text-gray-600 mt-2">
            <strong>Citation:</strong> <span id="panel-citation">-</span>
          </div>
        </div>

        <!-- Verification Methods -->
        <div class="border-t pt-4">
          <h3 class="font-semibold mb-3">‚úÖ Accepted Verification Methods</h3>
          <div id="panel-methods" class="space-y-1 text-sm">
            <!-- Populated by JS -->
          </div>
        </div>

        <!-- Notes -->
        <div id="panel-notes-section" class="border-t pt-4 hidden">
          <h3 class="font-semibold mb-2">üìå Important Notes</h3>
          <div class="text-sm text-gray-700 bg-yellow-50 p-3 rounded" id="panel-notes">-</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  
  <!-- App JS -->
  <script src="js/app.js"></script>
  
</body>
</html>
